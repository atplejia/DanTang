##å‰è¨€
*å¾ˆä¹…éƒ½æ²¡æœ‰å†™æ–‡ç« äº†ï¼Œå¾ˆæ—©ä¹‹å‰å°±ä¸€ç›´è¯´ä¸€è¯´Swifté¡¹ç›®çš„è®²è§£ï¼Œä½†æ˜¯è‡ªå·±çš„çŸ¥è¯†èŒƒå›´æœ‰é™ï¼Œå¾ˆå¤šä¸œè¥¿è¿˜æ˜¯ä¸çŸ¥é“çš„ï¼Œç»è¿‡å¤§åŠå¹´æ™šä¸Šåœ¨å…¬å¸å­¦ä¹ çš„æ—¶é—´,è‹¹æœSwiftè¯­è¨€çš„ç»ƒä¹ ï¼Œè¿æ¥äº†ä»Šå¤©çš„æ–‡ç« ï¼Œçœ‹çœ‹è§†é¢‘æ•™ç¨‹ï¼Œç»ƒä¹ åŸºç¡€ï¼Œä»¥åŠå¤šçœ‹å¼€æºçš„é¡¹ç›®ï¼Œåå¤çš„å†™ä»£ç ï¼Œè‡ªå·±éƒ½å†™åäº†ï¼Œçœ‹å¤šäº†éƒ½è§‰å¾—å¾ˆæ¶å¿ƒï¼Œè¿™æ¬¡çš„é¡¹ç›®æ˜¯è‡ªå·±é«˜ä»¿å¼€æºçš„é¡¹ç›®ï¼Œå·®ä¸å¤šå¯¹ç€å†™äº†ä¸€éå¤–åŠ è‡ªå·±å†™çš„çš„å°åŠŸèƒ½ï¼Œå“ˆå“ˆå“ˆğŸ˜„ï¼Œé‡ç‚¹æ˜¯å¸¦é¢†å¤§å®¶å¦‚ä½•å­¦ä¹ ,å¦‚ä½•æ€ä¹ˆä¸Šæ‰‹Swiftï¼Œæˆ‘è¿™é‡Œçš„å›ç­”åˆšåˆšå·²ç»è¯´å“ˆã€‚å¥½äº†ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹æ•ˆæœå›¾*

![Snip20160805_8.png](http://upload-images.jianshu.io/upload_images/1754828-b0f0c4a48e091c41.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

- è¿™æ˜¯æ•´ä¸ªé¡¹ç›®ç»“æ„ï¼Œè®²é¡¹ç›®ä¹‹å‰æˆ‘ä»¬å…ˆä¸ç€æ€¥ã€‚è¿™é‡Œå…ˆè¯´æ˜ä¸€ä¸‹`å•ç³–.xcworkspace`

![Snip20160805_9.png](http://upload-images.jianshu.io/upload_images/1754828-7ce6bb2b3dd0755e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

- å¾ˆå¤šå°ä¼™ä»¬éƒ½ä¸çŸ¥é“è¿™æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Œå¾ˆé™Œç”Ÿï¼Œå› ä¸ºXcodeåˆ›å»ºçš„éƒ½æ˜¯`xcodeproj`ä¸ºä»€ä¹ˆä¼šå¤šäº†`xcworkspace`ï¼Œè¿™æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Œç”¨æ¥å¹²ä»€ä¹ˆçš„ï¼Œæ˜¯æ€ä¹ˆç”Ÿæˆçš„ï¼Ÿå¾ˆå¤šçš„å¥‡æ€ªçš„é—®é¢˜ï¼Œå…¶å®è¿™æ˜¯æœ¬äººåœ¨Xcodeå®‰è£…çš„æ’ä»¶`cocoapods`

![Snip20160808_1.png](http://upload-images.jianshu.io/upload_images/1754828-cb9965811d83356e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

- `Xcode`æ²¡æœ‰æ€ä¹ˆåŠï¼Ÿæ€ä¹ˆå¼„çš„å‘¢ï¼Ÿè¿™æ˜¯è¦å»githubä¸‹è½½çš„

![Snip20160808_2.png](http://upload-images.jianshu.io/upload_images/1754828-08a66d55b6d0c73c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

ç‚¹å‡»githubå®˜ç½‘ï¼Œæœç´¢  `cocoapods`,ç‚¹å‡»æ—è¾¹çš„è¯­è¨€`object-c`ç¬¬ä¸€ä¸ªå°±æ˜¯æˆ‘ä»¬æ‰€è¦æ‰¾çš„æ’ä»¶ï¼Œå¯ä»¥ç‚¹å‡»è¿›å…¥ä»‹ç»

![Snip20160808_4.png](http://upload-images.jianshu.io/upload_images/1754828-819561c922997d69.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


![Snip20160808_5.png](http://upload-images.jianshu.io/upload_images/1754828-f3822f27568af1d2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

- ä¸‹è½½å¥½äº†ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹ä½¿ç”¨äº†ï¼Œç‚¹å‡»create/Edit podfileï¼Œä¼šçœ‹åˆ°è¦ä½ å¡«å†™ä¸€äº›ä¸œè¥¿ï¼Œè¿™é‡Œæˆ‘ç”¨é¡¹ç›®ä¸¾ä¾‹å­ï¼Œæƒ³è¦ä»€ä¹ˆæ¡†æ¶ç›´æ¥`pod "xxxx"`ï¼Œå¡«å†™å®Œæ¯•ä¹‹åç›´æ¥`install pods`å°±æ˜¯è¿™ä¹ˆç®€å•

```
source 'https://github.com/CocoaPods/Specs.git'
platform :ios, "8.0"
use_frameworks!

target :"å•ç³–" do
pod "SnapKit"
pod "Kingfisher"
pod "SVProgressHUD"
pod "FDFullscreenPopGesture", "~> 1.1"
pod "Alamofire"
pod "SwiftyJSON"

end
```


![Snip20160808_6.png](http://upload-images.jianshu.io/upload_images/1754828-2f46fe68086e9aa1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


- å…·ä½“æ€ä¹ˆå®‰è£…å’Œä½¿ç”¨ï¼Œæˆ‘è¿™é‡Œä¸ä»‹ç»äº†ï¼Œå°ä¼™ä¼´ä»¬å¯ä»¥è‡ªå·±å»åŠ¨æ‰‹è¯•ä¸€è¯•ï¼Œé‡åˆ°é—®é¢˜å¯ä»¥åœ¨è¯„è®ºç•™è¨€ï¼Œè¿™é‡Œæœ¬äººä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡æè¿™ä¸ªæ’ä»¶ä¹Ÿå¾ˆç—›è‹¦ï¼ŒèŠ±äº†ä¸€ä¸‹åˆçš„æ—¶é—´ï¼Œä¸æ˜¯å¾ˆéš¾ï¼Œè€Œæ˜¯å¾ˆçƒ¦ï¼Œä¸­é€”å‡ºç°å¾ˆå¤šé…ç½®é—®é¢˜ä»¥åŠç‰ˆæœ¬å…¼å®¹çš„é—®é¢˜ï¼Œçœ‹äººå“å§ï¼Œä¸æ˜¯æ¯å¤©ä¸€æ¬¡ç¯å¢ƒæ­å»ºéƒ½èƒ½æˆåŠŸ

###é¡¹ç›®è¯´æ˜

- è¿™é‡Œå¼€å§‹è®²è§£ä¸€ä¸‹é¡¹ç›®äº†ï¼Œä¸Šè¿°å†…å®¹æ˜¯è®²ä¸€ä¸‹å°çŸ¥è¯†çš„ä»‹ç»å’Œè®¤è¯†ä½¿ç”¨,å…ˆçœ‹çœ‹é¡¹ç›®çš„å¯åŠ¨

![å¯åŠ¨.gif](http://upload-images.jianshu.io/upload_images/1754828-29af7b631e5f20c6.gif?imageMogr2/auto-orient/strip)

- `Swift`é¡¹ç›®ä¹Ÿæ˜¯ä¸€æ ·ï¼Œéƒ½æ˜¯åœ¨`AppDelegate.swift`è¿™ä¸ªç±»å¯åŠ¨ç¨‹åº

```
class AppDelegate: UIResponder, UIApplicationDelegate {

    var window: UIWindow?
    

    func application(application: UIApplication, didFinishLaunchingWithOptions launchOptions: [NSObject: AnyObject]?) -> Bool {
        // Override point for customization after application launch.
        //åˆ›å»ºwindow
        window = UIWindow(frame: UIScreen.mainScreen().bounds)
        window?.makeKeyAndVisible()
        //æ£€æŸ¥è¿›å…¥æ²™ç›’æ˜¯å¦å¼•å¯¼é¡µçš„åˆ¤æ–­
        if !NSUserDefaults.standardUserDefaults().boolForKey(QJLFirstLaunch) {
            window?.rootViewController = QJLNewfeatureViewController()
            NSUserDefaults.standardUserDefaults().setBool(true, forKey: QJLFirstLaunch)
        }else{
            window?.rootViewController = QJLTabBarController()
        }
        
   
        setUM()
        return true
        
    }
    
    //é‡å†™openURL
    func application(app: UIApplication, openURL url: NSURL, options: [String : AnyObject])
        -> Bool {
            return TencentOAuth.HandleOpenURL(url)
    }
    
    //é‡å†™handleOpenURL
    func application(application: UIApplication, handleOpenURL url: NSURL) -> Bool {
        return TencentOAuth.HandleOpenURL(url)
    }

```
- å’Œocç›¸è¯†ï¼Œåªæ˜¯å†™æ³•çœ‹ç€æœ‰ç‚¹åˆ«æ‰­ï¼Œå¯åŠ¨çš„æ—¶å€™åˆ¤æ–­æ˜¯å¦æ˜¯æ²™ç›’ï¼Œä¸çŸ¥é“æ€ä¹ˆå®ç°çš„å¯ä»¥å»ç™¾åº¦æ€ä¹ˆå®Œæˆçš„ï¼Œè¿˜æœ‰å°±æ˜¯å¦‚ä½•å®šä¹‰ä¸€ä¸ªæ–¹æ³•,swiftå°±æ˜¯ç”¨å‡½æ•°å®šä¹‰ä¸€ä¸ªæ–¹æ³•æˆ‘ä»¬çœ‹åˆ°å¯åŠ¨`setUM`å‹ç›Ÿè¿™æ˜¯ï¼Œç„¶åå®ç°è¿™ä¸ªæ–¹æ³•å°±æ˜¯`func setUM() {}`,ocå‘¢ï¼Ÿ`[self XXX] ` å®ç°å°±æ˜¯`-(void)xxxx`
å†™æ³•ä¸Šå¾ˆå¤šçš„åˆ«æ‰­ï¼Œæˆ‘ä»¬åœ¨çœ‹çœ‹ç»“æ„`TabbarController`è¿™ä¸ªæ§åˆ¶å™¨

```
class QJLTabBarController: UITabBarController {

    override func viewDidLoad() {
        super.viewDidLoad()
        tabBar.tintColor = UIColor(red: 245 / 255, green: 80 / 255, blue: 83 / 255, alpha: 1.0)
        // æ·»åŠ å­æ§åˆ¶å™¨
        addChildViewControllers()
    }

    override func didReceiveMemoryWarning() {
        super.didReceiveMemoryWarning()
        // Dispose of any resources that can be recreated.
    }
    

    /**
     # æ·»åŠ å­æ§åˆ¶å™¨
     */
    private func addChildViewControllers() {
        addChildViewController("QJLDanTangViewController", title: "å•ç³–", imageName: "TabBar_home_23x23_")
        addChildViewController("QJLProductViewController", title: "å•å“", imageName: "TabBar_gift_23x23_")
        addChildViewController("QJLCategoryViewController", title: "åˆ†ç±»", imageName: "TabBar_category_23x23_")
        addChildViewController("QJLMeViewController", title: "æˆ‘", imageName: "TabBar_me_boy_23x23_")
    }
    
    /**
     # åˆå§‹åŒ–å­æ§åˆ¶å™¨
     
     - parameter childControllerName: éœ€è¦åˆå§‹åŒ–çš„æ§åˆ¶å™¨
     - parameter title:               æ ‡é¢˜
     - parameter imageName:           å›¾ç‰‡åç§°
     */
    private func addChildViewController(childControllerName: String, title: String, imageName: String) {
        // åŠ¨æ€è·å–å‘½åç©ºé—´
        let ns = NSBundle.mainBundle().infoDictionary!["CFBundleExecutable"] as! String
        // å°†å­—ç¬¦ä¸²è½¬åŒ–ä¸ºç±»ï¼Œé»˜è®¤æƒ…å†µä¸‹å‘½åç©ºé—´å°±æ˜¯é¡¹ç›®åç§°ï¼Œä½†æ˜¯å‘½åç©ºé—´å¯ä»¥ä¿®æ”¹
        let cls: AnyClass? = NSClassFromString(ns + "." + childControllerName)
        let vcClass = cls as! UIViewController.Type
        let vc = vcClass.init()
        // è®¾ç½®å¯¹åº”çš„æ•°æ®
        vc.tabBarItem.image = UIImage(named: imageName)
        vc.tabBarItem.selectedImage = UIImage(named: imageName + "selected")
        vc.title = title
        // ç»™æ¯ä¸ªæ§åˆ¶å™¨åŒ…è£…ä¸€ä¸ªå¯¼èˆªæ§åˆ¶å™¨
        let nav = QJLNavigationController()
        nav.addChildViewController(vc)
        addChildViewController(nav)
    }
}

```

- è‡ªå®šä¹‰çš„`Tabbar`å’Œocçš„å†™æ³•ä¹Ÿä¸€è‡´ï¼Œåªæ˜¯çœ‹ç€ç®€å•äº†å¾ˆå¤šï¼Œåˆ†åˆ«åŠ ä¸Šå››å¤§æ§åˆ¶å™¨ï¼Œè¿˜æœ‰é‚£å¥åŒ…è£…ä¸€ä¸ªå¯¼èˆªæ§åˆ¶å™¨ä¹Ÿæ˜¯ä¸€æ ·

![Snip20160808_7.png](http://upload-images.jianshu.io/upload_images/1754828-a7d6cddfa15ef807.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

```
import UIKit
import SVProgressHUD

class QJLNavigationController: UINavigationController {

    override func viewDidLoad() {
        super.viewDidLoad()
        //è®¾ç½®å¯¼èˆªæ çš„æ ‡é¢˜æ 
        let navBar = UINavigationBar.appearance()
        navBar.barTintColor = QJLlobalRedColor()
        navBar.tintColor = UIColor.whiteColor()
        navBar.titleTextAttributes = [NSForegroundColorAttributeName: UIColor.whiteColor(),NSFontAttributeName:UIFont .systemFontOfSize(20)]

    }

    /**
     # ç»Ÿä¸€æ‰€æœ‰æ§åˆ¶å™¨å¯¼èˆªæ å·¦ä¸Šè§’çš„è¿”å›æŒ‰é’®
     # è®©æ‰€æœ‰pushè¿›æ¥çš„æ§åˆ¶å™¨ï¼Œå®ƒçš„å¯¼èˆªæ å·¦ä¸Šè§’çš„å†…å®¹éƒ½ä¸€æ ·
     # èƒ½æ‹¦æˆªæ‰€æœ‰çš„pushæ“ä½œ
     - parameter viewController: éœ€è¦å‹æ ˆçš„æ§åˆ¶å™¨
     - parameter animated:       æ˜¯å¦åŠ¨ç”»
     */
    override func pushViewController(viewController: UIViewController, animated: Bool) {
        /// è¿™æ—¶pushè¿›æ¥çš„æ§åˆ¶å™¨viewControllerï¼Œä¸æ˜¯ç¬¬ä¸€ä¸ªå­æ§åˆ¶å™¨ï¼ˆä¸æ˜¯æ ¹æ§åˆ¶å™¨ï¼‰
        if viewControllers.count > 0 {
            // push åéšè— tabbar
            viewController.hidesBottomBarWhenPushed = true
            viewController.navigationItem.leftBarButtonItem = UIBarButtonItem(image: UIImage(named: "checkUserType_backward_9x15_"), style: .Plain, target: self, action: #selector(navigationBackClick))
        }
        super.pushViewController(viewController, animated: true)
    }
    /// è¿”å›æŒ‰é’®
    func navigationBackClick() {
        if SVProgressHUD.isVisible() {
            SVProgressHUD.dismiss()
        }
        if UIApplication.sharedApplication().networkActivityIndicatorVisible {
            UIApplication.sharedApplication().networkActivityIndicatorVisible = false
        }
        popViewControllerAnimated(true)
    }

}
```

- siwftå¯¼å…¥ç¬¬ä¸‰æ–¹æ–‡ä»¶æ˜¯`import XXX`ï¼Œè¯´æ˜ä¸€ä¸‹ï¼Œsiwftæ— éœ€å¯¼å…¥åº”ç”¨ç±»ï¼Œå®ƒè‡ªå·±ä¼šæ‰¾åˆ°åœ¨å“ªé‡Œï¼Œä¸€èˆ¬éƒ½æ˜¯å¯¼å…¥ä¸€ä¸‹ç¬¬ä¸‰æ–¹çš„åº“ï¼Œè¿™å°±è¦ç”¨åˆ°æ¡¥æ¥äº†`å•ç³–-Bridging-Header`,æˆ‘è¿™é‡Œé‡ç‚¹è¯´æ˜ï¼Œè¿™ä¸ªå¾ˆé‡è¦ï¼Œæ€ä¹ˆæ¡¥æ¥ocç±»ï¼Œä¸‹å›¾å°±æ˜¯æ¡¥æ¥é…ç½®ï¼Œé¦–å…ˆè¦è®¾ç½®ä¸€ä¸‹å¤´æ–‡ä»¶çš„è·¯å¾„ï¼Œ`é¡¹ç›®åå­—/æ–‡ä»¶å`ç„¶ååœ¨å¤´æ–‡ä»¶å†™ä¸Šè¦å¼•ç”¨çš„ç±»



![Snip20160808_8.png](http://upload-images.jianshu.io/upload_images/1754828-130ae5fef276082c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

![Snip20160808_9.png](http://upload-images.jianshu.io/upload_images/1754828-e1728f135982e581.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

- åœ¨å¤´æ–‡ä»¶å†™ä¸Šå¼•å…¥çš„ç±»ï¼Œè¿™æ ·å°±æ¡¥æ¥ocäº†,è¿™é‡Œçœ‹åˆ°äº†ä¸€äº›SKDçš„åº”ç”¨è…¾è®¯çš„è¿˜æœ‰å‹ç›Ÿçš„,ä»¥åŠææ˜æ°è€å¸ˆçš„åˆ·æ–°æ¡†æ¶
- æœ‰å…³äºå®ï¼ŒSwiftæ²¡æœ‰å®å®šä¹‰ï¼Œè¿˜æœ‰å’Œå®å®šä¹‰ç›¸è¯†çš„
- ç›´æ¥åˆ›å»ºä¸€ä¸ªsiwftç±»ï¼Œåé¢æƒ³å†™ä»€ä¹ˆè‡ªå·±å»å¡«å†™

```

import UIKit

enum QJLTopicType: Int {
    /// ç²¾é€‰
    case Selection = 4
    /// ç¾é£Ÿ
    case Food = 14
    /// å®¶å±…
    case Household = 16
    /// æ•°ç 
    case Digital = 17
    /// ç¾ç‰©
    case GoodThing = 13
    /// æ‚è´§
    case Grocery = 22
}

enum QJLShareButtonType: Int {
    /// å¾®ä¿¡æœ‹å‹åœˆ
    case WeChatTimeline = 0
    /// å¾®ä¿¡å¥½å‹
    case WeChatSession = 1
    /// å¾®åš
    case Weibo = 2
    /// QQ ç©ºé—´
    case QZone = 3
    /// QQ å¥½å‹
    case QQFriends = 4
    /// å¤åˆ¶é“¾æ¥
    case CopyLink = 5
}

enum QJLOtherLoginButtonType: Int {
    /// å¾®åš
    case weiboLogin = 100
    /// å¾®ä¿¡
    case weChatLogin = 101
    /// QQ
    case QQLogin = 102
}

/// æœåŠ¡å™¨åœ°å€
let BASE_URL = "http://api.dantangapp.com/"

/// ç¬¬ä¸€æ¬¡å¯åŠ¨
let QJLFirstLaunch = "firstLaunch"
/// æ˜¯å¦ç™»å½•
let isLogin = "isLogin"

/// code ç  200 æ“ä½œæˆåŠŸ
let RETURN_OK = 200
/// é—´è·
let kMargin: CGFloat = 10.0
/// åœ†è§’
let kCornerRadius: CGFloat = 5.0
/// çº¿å®½
let klineWidth: CGFloat = 1.0
/// é¦–é¡µé¡¶éƒ¨æ ‡ç­¾æŒ‡ç¤ºæ¡çš„é«˜åº¦
let kIndicatorViewH: CGFloat = 2.0
/// æ–°ç‰¹æ€§ç•Œé¢å›¾ç‰‡æ•°é‡
let kNewFeatureCount = 4
/// é¡¶éƒ¨æ ‡é¢˜çš„é«˜åº¦
let kTitlesViewH: CGFloat = 35
/// é¡¶éƒ¨æ ‡é¢˜çš„y
let kTitlesViewY: CGFloat = 64
/// åŠ¨ç”»æ—¶é•¿
let kAnimationDuration = 0.25
/// å±å¹•çš„å®½
let SCREENW = UIScreen.mainScreen().bounds.size.width
/// å±å¹•çš„é«˜
let SCREENH = UIScreen.mainScreen().bounds.size.height
/// åˆ†ç±»ç•Œé¢ é¡¶éƒ¨ item çš„é«˜
let kitemH: CGFloat = 75
/// åˆ†ç±»ç•Œé¢ é¡¶éƒ¨ item çš„å®½
let kitemW: CGFloat = 150
// åˆ†äº«æŒ‰é’®èƒŒæ™¯é«˜åº¦
let kTopViewH: CGFloat = 230
public let CouponViewControllerMargin: CGFloat = 20


/// RGBAçš„é¢œè‰²è®¾ç½®
func QJLColor(r:CGFloat, g:CGFloat, b:CGFloat, a:CGFloat) -> UIColor {
    return UIColor(red: r / 255.0, green: g / 255.0, blue: b / 255.0, alpha: a)
}

/// èƒŒæ™¯ç°è‰²
func QJLGlobalColor() -> UIColor {
    return QJLColor(240, g: 240, b: 240, a: 1)
}

/// çº¢è‰²
func QJLlobalRedColor() -> UIColor {
    return QJLColor(245, g: 80, b: 83, a: 1.0)
}

public let GitHubURLString: String = "http://git.oschina.net/www.skyheng.com"
public let SinaWeiBoURLString: String = "http://weibo.com/u/5500516766?sudaref=www.jianshu.com&retcode=6102&is_all=1"
public let BlogURLString: String = "http://www.jianshu.com/users/ef13bae228f6/latest_articles"
/// è´­ä¹°å•†å“æ•°é‡å‘ç”Ÿæ”¹å˜
public let LFBShopCarBuyProductNumberDidChangeNotification = "LFBShopCarBuyProductNumberDidChangeNotification"
public let HomeCollectionTextFont = UIFont.systemFontOfSize(14)

/// iPhone 5
let isIPhone5 = SCREENH == 568 ? true : false
/// iPhone 6
let isIPhone6 = SCREENH == 667 ? true : false
/// iPhone 6P
let isIPhone6P = SCREENH == 736 ? true : false

```

###é¦–é¡µ

- æˆ‘ä»¬å…ˆçœ‹çœ‹é¦–é¡µçš„å…·ä½“å†…å®¹çš„å®ç°
- è¯´æ˜ä¸€ä¸‹åœ¨Swiftä¸­ç”¨åˆ°å¸ƒå±€æ¡†æ¶æ˜¯`SnapKit`è€Œocä¸­æ˜¯ç”¨Marsonyå¸ƒå±€ï¼ŒSwiftæ˜¯ç”¨`Alamofire`æ¡†æ¶ï¼Œè€Œocä¸­æ˜¯ç”¨`AFN`

```
    override func viewDidLoad() {
        super.viewDidLoad()
        // è®¾ç½®å¯¼èˆªæ 
        setupNav()
        weak var weakSelf = self
        // è·å–é¦–é¡µé¡¶éƒ¨é€‰æ‹©æ•°æ®
        QJLNetworkTool.shareNetworkTool.loadHomeTopData { (ym_channels) in
            for channel in ym_channels {
                let vc = QJLTopicViewController()
                vc.title = channel.name!
                vc.type = channel.id!
                weakSelf!.addChildViewController(vc)
            }
            //è®¾ç½®é¡¶éƒ¨æ ‡ç­¾æ 
            weakSelf!.setupTitlesView()
            // åº•éƒ¨çš„scrollview
            weakSelf!.setupContentView()
        }
    }

```
- åœ¨`viewDidLoad`è¿™ä¸ªæ–¹æ³•ä¸­å®ç°UIç•Œé¢ï¼Œå¯ä»¥çœ‹åˆ°`setupNav()`è¿™ä¸ªå‡½æ•°ï¼Œè¿˜æœ‰åˆ†åˆ«è®¾ç½®é¡¶éƒ¨é€‰æ‹©æ•°æ®çš„æ ‡ç­¾å’Œ åº•éƒ¨æ»šåŠ¨çš„`scrollview`

```
  /// é¡¶éƒ¨æ ‡ç­¾æ 
    func setupTitlesView() {
        // é¡¶éƒ¨èƒŒæ™¯
        let bgView = UIView()
        bgView.frame = CGRectMake(0, kTitlesViewY, SCREENW, kTitlesViewH)
        view.addSubview(bgView)
        // æ ‡ç­¾
        let titlesView = UIView()
        titlesView.backgroundColor = QJLGlobalColor()
        titlesView.frame = CGRectMake(0, 0, SCREENW - kTitlesViewH, kTitlesViewH)
        bgView.addSubview(titlesView)
        self.titlesView = titlesView
        //åº•éƒ¨çº¢è‰²æŒ‡ç¤ºå™¨
        let indicatorView = UIView()
        indicatorView.backgroundColor = QJLlobalRedColor()
        indicatorView.height = kIndicatorViewH
        indicatorView.y = kTitlesViewH - kIndicatorViewH
        indicatorView.tag = -1
        self.indicatorView = indicatorView
        
        // å³è¾¹æœç´¢é€‰æ‹©æŒ‰é’®
        let arrowButton = UIButton()
        arrowButton.frame = CGRectMake(SCREENW - kTitlesViewH, 0, kTitlesViewH, kTitlesViewH)
        arrowButton.setImage(UIImage(named: "arrow_index_down_8x4_"), forState: .Normal)
        arrowButton.addTarget(self, action: #selector(arrowButtonClick(_:)), forControlEvents: .TouchUpInside)
        arrowButton.backgroundColor = QJLGlobalColor()
        bgView.addSubview(arrowButton)
        
        //å†…éƒ¨å­æ ‡ç­¾
        let count = childViewControllers.count
        let width = titlesView.width / CGFloat(count)
        let height = titlesView.height
        
        for index in 0..<count {
            let button = UIButton()
            button.height = height
            button.width = width
            button.x = CGFloat(index) * width
            button.tag = index
            let vc = childViewControllers[index]
            button.titleLabel!.font = UIFont.systemFontOfSize(14)
            button.setTitle(vc.title!, forState: .Normal)
            button.setTitleColor(UIColor.grayColor(), forState: .Normal)
            button.setTitleColor(QJLlobalRedColor(), forState: .Disabled)
            button.addTarget(self, action: #selector(titlesClick(_:)), forControlEvents: .TouchUpInside)
            titlesView.addSubview(button)
            //é»˜è®¤ç‚¹å‡»äº†ç¬¬ä¸€ä¸ªæŒ‰é’®
            if index == 0 {
                button.enabled = false
                selectedButton = button
                //è®©æŒ‰é’®å†…éƒ¨çš„Labelæ ¹æ®æ–‡å­—æ¥è®¡ç®—å†…å®¹
                button.titleLabel?.sizeToFit()
                indicatorView.width = button.titleLabel!.width
                indicatorView.centerX = button.centerX
            }
        }
        //åº•éƒ¨çº¢è‰²æŒ‡ç¤ºå™¨
        titlesView.addSubview(indicatorView)
    }
    
    /// ç®­å¤´æŒ‰é’®ç‚¹å‡»
    func arrowButtonClick(button: UIButton) {
        UIView.animateWithDuration(kAnimationDuration) {
            button.imageView?.transform = CGAffineTransformRotate(button.imageView!.transform, CGFloat(M_PI))
        }
    }
    
    /// æ ‡ç­¾ä¸Šçš„æŒ‰é’®ç‚¹å‡»
    func titlesClick(button: UIButton) {
        // ä¿®æ”¹æŒ‰é’®çŠ¶æ€
        selectedButton!.enabled = true
        button.enabled = false
        selectedButton = button
        // è®©æ ‡ç­¾æ‰§è¡ŒåŠ¨ç”»
        UIView.animateWithDuration(kAnimationDuration) {
            self.indicatorView!.width = self.selectedButton!.titleLabel!.width
            self.indicatorView!.centerX = self.selectedButton!.centerX
        }
        //æ»šåŠ¨,åˆ‡æ¢å­æ§åˆ¶å™¨
        var offset = contentView!.contentOffset
        offset.x = CGFloat(button.tag) * contentView!.width
        contentView!.setContentOffset(offset, animated: true)
    }
    
    /// åº•éƒ¨çš„scrollview
    func setupContentView() {
        //ä¸è¦è‡ªåŠ¨è°ƒæ•´inset
        automaticallyAdjustsScrollViewInsets = false
        
        let contentView = UIScrollView()
        contentView.frame = view.bounds
        contentView.delegate = self
        contentView.contentSize = CGSizeMake(contentView.width * CGFloat(childViewControllers.count), 0)
        contentView.pagingEnabled = true
        view.insertSubview(contentView, atIndex: 0)
        self.contentView = contentView
        //æ·»åŠ ç¬¬ä¸€ä¸ªæ§åˆ¶å™¨çš„view
        scrollViewDidEndScrollingAnimation(contentView)
    }
    
    /// è®¾ç½®å¯¼èˆªæ 
    func setupNav() {
        view.backgroundColor = UIColor.whiteColor()
        navigationItem.rightBarButtonItem = UIBarButtonItem(image: UIImage(named: "Feed_SearchBtn_18x18_"), style: .Plain, target: self, action: #selector(dantangRightBBClick))
        
        navigationItem.leftBarButtonItem = UIBarButtonItem(image: UIImage(named: "icon_black_scancode"), style: .Plain, target: self, action: #selector(leftItemClick))
       
    }


```

- å¯¼èˆªæ å·¦å³ä¸¤è¾¹çš„äºŒç»´ç æ‰«ä¸€æ‰«æ˜¯ç”¨`QRCode`,å®ç°çš„

```
import UIKit
import AVFoundation


class QRCodeViewController: QJLBaseViewController,AVCaptureMetadataOutputObjectsDelegate {
    private var titleLabel = UILabel()
    private var captureSession: AVCaptureSession?
    private var videoPreviewLayer: AVCaptureVideoPreviewLayer?
    private var animationLineView = UIImageView()
    private var timer: NSTimer?
    
    
    
    override func viewDidLoad() {
        super.viewDidLoad()
        
        
        buildInputAVCaptureDevice()
        
        buildFrameImageView()
        
        buildTitleLabel()
        
        buildAnimationLineView()

        // Do any additional setup after loading the view.
    }
    
    

    override func viewWillDisappear(animated: Bool) {
        super.viewWillDisappear(animated)
        if timer != nil {
            timer!.invalidate()
            timer = nil
        }
    }
    
    private func buildTitleLabel() {
        
        titleLabel.textColor = UIColor.whiteColor()
        titleLabel.font = UIFont.systemFontOfSize(16)
        titleLabel.frame = CGRectMake(0, 340, ScreenWidth, 30)
        titleLabel.textAlignment = NSTextAlignment.Center
        view.addSubview(titleLabel)
    }
    
    private func buildInputAVCaptureDevice() {
        
        let captureDevice = AVCaptureDevice.defaultDeviceWithMediaType(AVMediaTypeVideo)
        titleLabel.text = "è¯·å¯¹å‡†äºŒç»´ç æ–¹å—å†…æ‰«é¢"
        let input = try? AVCaptureDeviceInput(device: captureDevice)
        if input == nil {
            titleLabel.text = "è¯·æ¢çœŸæœºè¯•è¯•"
            
            return
        }
        
        let captureMetadataOutput = AVCaptureMetadataOutput()
        captureSession = AVCaptureSession()
        captureSession?.addInput(input!)
        captureSession?.addOutput(captureMetadataOutput)
        let dispatchQueue = dispatch_queue_create("myQueue", nil)
        captureMetadataOutput.setMetadataObjectsDelegate(self, queue: dispatchQueue)
        captureMetadataOutput.metadataObjectTypes = [AVMetadataObjectTypeQRCode, AVMetadataObjectTypeAztecCode]
        
        videoPreviewLayer = AVCaptureVideoPreviewLayer(session: captureSession)
        videoPreviewLayer?.videoGravity = AVLayerVideoGravityResizeAspectFill
        videoPreviewLayer?.frame = view.layer.frame
        view.layer.addSublayer(videoPreviewLayer!)
        captureMetadataOutput.rectOfInterest = CGRectMake(0, 0, 1, 1)
        
        captureSession?.startRunning()
    }
    
    private func buildFrameImageView() {
        
        let lineT = [CGRectMake(0, 0, ScreenWidth, 100),
                     CGRectMake(0, 100, ScreenWidth * 0.2, ScreenWidth * 0.6),
                     CGRectMake(0, 100 + ScreenWidth * 0.6, ScreenWidth, ScreenHeight - 100 - ScreenWidth * 0.6),
                     CGRectMake(ScreenWidth * 0.8, 100, ScreenWidth * 0.2, ScreenWidth * 0.6)]
        for lineTFrame in lineT {
            buildTransparentView(lineTFrame)
        }
        
        let lineR = [CGRectMake(ScreenWidth * 0.2, 100, ScreenWidth * 0.6, 2),
                     CGRectMake(ScreenWidth * 0.2, 100, 2, ScreenWidth * 0.6),
                     CGRectMake(ScreenWidth * 0.8 - 2, 100, 2, ScreenWidth * 0.6),
                     CGRectMake(ScreenWidth * 0.2, 100 + ScreenWidth * 0.6, ScreenWidth * 0.6, 2)]
        
        for lineFrame in lineR {
            buildLineView(lineFrame)
        }
        
        let yellowHeight: CGFloat = 4
        let yellowWidth: CGFloat = 30
        let yellowX: CGFloat = ScreenWidth * 0.2
        let bottomY: CGFloat = 100 + ScreenWidth * 0.6
        let lineY = [CGRectMake(yellowX, 100, yellowWidth, yellowHeight),
                     CGRectMake(yellowX, 100, yellowHeight, yellowWidth),
                     CGRectMake(ScreenWidth * 0.8 - yellowHeight, 100, yellowHeight, yellowWidth),
                     CGRectMake(ScreenWidth * 0.8 - yellowWidth, 100, yellowWidth, yellowHeight),
                     CGRectMake(yellowX, bottomY - yellowHeight + 2, yellowWidth, yellowHeight),
                     CGRectMake(ScreenWidth * 0.8 - yellowWidth, bottomY - yellowHeight + 2, yellowWidth, yellowHeight),
                     CGRectMake(yellowX, bottomY - yellowWidth, yellowHeight, yellowWidth),
                     CGRectMake(ScreenWidth * 0.8 - yellowHeight, bottomY - yellowWidth, yellowHeight, yellowWidth)]
        
        for yellowRect in lineY {
            buildYellowLineView(yellowRect)
        }
    }
    
    private func buildLineView(frame: CGRect) {
        let view1 = UIView(frame: frame)
        view1.backgroundColor = QJLColor(253, g: 212, b: 49,a: 1)
        view.addSubview(view1)
    }
    
    private func buildYellowLineView(frame: CGRect) {
        let yellowView = UIView(frame: frame)
        yellowView.backgroundColor = QJLColor(253, g: 212, b: 49,a: 1)
        view.addSubview(yellowView)
    }
    
    private func buildTransparentView(frame: CGRect) {
        let tView = UIView(frame: frame)
        tView.backgroundColor = UIColor.blackColor()
        tView.alpha = 0.5
        view.addSubview(tView)
    }
    
    private func buildAnimationLineView() {
        animationLineView.image = UIImage(named: "yellowlight")
        view.addSubview(animationLineView)
        
        timer = NSTimer(timeInterval: 2.5, target: self, selector: "startYellowViewAnimation", userInfo: nil, repeats: true)
        let runloop = NSRunLoop.currentRunLoop()
        runloop.addTimer(timer!, forMode: NSRunLoopCommonModes)
        timer!.fire()
    }
    
    func startYellowViewAnimation() {
        weak var weakSelf = self
        animationLineView.frame = CGRectMake(ScreenWidth * 0.2 + ScreenWidth * 0.1 * 0.5, 100, ScreenWidth * 0.5, 20)
        UIView.animateWithDuration(2.5) { () -> Void in
            weakSelf!.animationLineView.frame.origin.y += ScreenWidth * 0.55
        }
    }

    

}

```
- è‡ªå®šä¹‰çš„ä¸œè¥¿æ¯”è¾ƒå¤šï¼Œè¿˜æœ‰è®¾è®¡å…¶ä»–çš„è¾…åŠ©ç±»ä¹Ÿå¾ˆå¤šï¼Œæˆ‘è¿™é‡Œå¤§å¤šæ•°éƒ½æ˜¯è‡ªå·±å»æ‰¾çš„ã€‚

![é¦–é¡µ.gif](http://upload-images.jianshu.io/upload_images/1754828-55fd70f9d14b9e58.gif?imageMogr2/auto-orient/strip)



###å•å“

- å•å“è¿™ä¸ªé¡µé¢æ˜¯ç”¨`setupCollectionView`å®ç°çš„ï¼Œå’Œocä¸­çš„ä¸€æ ·

```
    override func viewDidLoad() {
        super.viewDidLoad()
        /// è®¾ç½®collectionView
        setupCollectionView()
        
        weak var weakSelf = self
        QJLNetworkTool.shareNetworkTool.loadProductData { (products) in
            weakSelf!.products = products
            weakSelf!.collectionView!.reloadData()
        }
    }
    
    /// è®¾ç½®collectionView
    private func setupCollectionView() {
        let collectionView = UICollectionView(frame: view.bounds, collectionViewLayout: UICollectionViewFlowLayout())
        collectionView.delegate = self
        collectionView.backgroundColor = view.backgroundColor
        collectionView.dataSource = self
        let nib = UINib(nibName: String(QJLCollectionViewCell), bundle: nil)
        collectionView.registerNib(nib, forCellWithReuseIdentifier: collectionCellID)
        view.addSubview(collectionView)
        self.collectionView = collectionView
    }

```

- ç„¶åå®ç°å®ƒçš„ä»£ç†æ–¹æ³•

```
extension QJLProductViewController: UICollectionViewDelegate, UICollectionViewDataSource,  UICollectionViewDelegateFlowLayout, QJLCollectionViewCellDelegate {
    
    // MARK: - UICollectionViewDataSource
    func collectionView(collectionView: UICollectionView, numberOfItemsInSection section: Int) -> Int {
        return products.count ?? 0
    }
    
    func collectionView(collectionView: UICollectionView, cellForItemAtIndexPath indexPath: NSIndexPath) -> UICollectionViewCell {
        let cell = collectionView.dequeueReusableCellWithReuseIdentifier(collectionCellID, forIndexPath: indexPath) as! QJLCollectionViewCell
        cell.product = products[indexPath.item]
        cell.delegate = self
        return cell
    }
    
    // MARK: - UICollectionViewDelegate
    func collectionView(collectionView: UICollectionView, didSelectItemAtIndexPath indexPath: NSIndexPath) {
        let productDetailVC = QJLProductDetailViewController()
        productDetailVC.title = "å•†å“è¯¦æƒ…"
        productDetailVC.product = products[indexPath.item]
        navigationController?.pushViewController(productDetailVC, animated: true)
    }
    
    // MARK: - UICollectionViewDelegateFlowLayout
    func collectionView(collectionView: UICollectionView, layout collectionViewLayout: UICollectionViewLayout, sizeForItemAtIndexPath indexPath: NSIndexPath) -> CGSize {
        let width: CGFloat = (UIScreen.mainScreen().bounds.width - 20) / 2
        let height: CGFloat = 245
        return CGSizeMake(width, height)
    }
    
    func collectionView(collectionView: UICollectionView, layout collectionViewLayout: UICollectionViewLayout, insetForSectionAtIndex section: Int) -> UIEdgeInsets {
        return UIEdgeInsetsMake(5, 5, 5, 5)
    }
    
    // MARK: - YMCollectionViewCellDelegate
    func collectionViewCellDidClickedLikeButton(button: UIButton) {
        if !NSUserDefaults.standardUserDefaults().boolForKey(isLogin) {
            let loginVC = QJLLoginViewController()
            loginVC.title = "ç™»å½•"
            let nav = QJLNavigationController(rootViewController: loginVC)
            presentViewController(nav, animated: true, completion: nil)
        } else {
            
        }
    }



```

- è¿™é‡Œä»‹ç»ä¸€ä¸‹Swiftçš„ç½‘ç»œè¯·æ±‚`NetworkTool`è¿™ä¸ªç±»çš„æ–¹æ³•ä»‹ç»,è¿™ä¸ªå¯¹äºæ–°çš„ç½‘ç»œè¯·æ±‚å¯èƒ½æ˜¯ä¸€ç§éš¾åº¦çš„ï¼Œä½œè€…æœ¬äººä¹Ÿæ˜¯æ²¡æœ‰è®¤çœŸæ·±å…¥ï¼Œåªæ˜¯äº†è§£ã€‚

```
    /// è·å–é¦–é¡µæ•°æ®
    func loadHomeInfo(id: Int, finished:(homeItems: [QJLHomeItem]) -> ()) {

        let url = BASE_URL + "v1/channels/\(id)/items"
        let params = ["gender": 1,
                      "generation": 1,
                      "limit": 20,
                      "offset": 0]
        Alamofire
            .request(.GET, url, parameters: params)
            .responseJSON { (response) in
                guard response.result.isSuccess else {
                    SVProgressHUD.showErrorWithStatus("åŠ è½½å¤±è´¥...")
                    return
                }
                if let value = response.result.value {
                    let dict = JSON(value)
                    let code = dict["code"].intValue
                    let message = dict["message"].stringValue
                    guard code == RETURN_OK else {
                        SVProgressHUD.showInfoWithStatus(message)
                        return
                    }
                    let data = dict["data"].dictionary
                    //  å­—å…¸è½¬æˆæ¨¡å‹
                    if let items = data!["items"]?.arrayObject {
                        var homeItems = [QJLHomeItem]()
                        for item in items {
                            let homeItem = QJLHomeItem(dict: item as! [String: AnyObject])
                            homeItems.append(homeItem)
                        }
                        finished(homeItems: homeItems)
                    }
                }
        }
    }

```

![å•å“.gif](http://upload-images.jianshu.io/upload_images/1754828-997b90a47746cbd4.gif?imageMogr2/auto-orient/strip)

###åˆ†ç±»

- è¿™æ ·é¡µé¢æœ€ç®€å•äº†ï¼Œä»£ç çš„è¯å°±è¿™ä¹ˆç‚¹,`ScrollView`å®ç°ç‚¹å‡»é¡µé¢è·³è½¬å°±å¯ä»¥äº†ï¼Œä¸ç†Ÿç»ƒçš„åŒå­¦å¯ä»¥å‚ç…§ä»£ç å¯¹ç€å†™ä¸€éå°±okäº†ï¼Œå…¶å®å°±æ˜¯å¤šè”ç³»

```
    override func viewDidLoad() {
        super.viewDidLoad()
        
        navigationItem.rightBarButtonItem = UIBarButtonItem(image: UIImage(named: "Feed_SearchBtn_18x18_"), style: .Plain, target: self, action: #selector(categoryRightBBClick))
        setupScrollView()

        // Do any additional setup after loading the view.
    }

    private func setupScrollView() {
        view.addSubview(scrollView)
        // é¡¶éƒ¨æ§åˆ¶å™¨
        let headerViewController = QJLCategoryHeaderViewController()
        addChildViewController(headerViewController)
        
        let topBGView = UIView(frame: CGRectMake(0, 0, SCREENW, 135))
        scrollView.addSubview(topBGView)
        
        let headerVC = childViewControllers[0]
        topBGView.addSubview(headerVC.view)
        
        let bottomBGView = QJLCategoryBottomView(frame: CGRectMake(0, CGRectGetMaxY(topBGView.frame) + 10, SCREENW, SCREENH - 160))
        bottomBGView.backgroundColor = QJLGlobalColor()
        bottomBGView.delegate = self
        scrollView.addSubview(bottomBGView)
        scrollView.contentSize = CGSizeMake(SCREENW, CGRectGetMaxY(bottomBGView.frame))
    }
    

```



![åˆ†ç±».gif](http://upload-images.jianshu.io/upload_images/1754828-9e98fa5122a31557.gif?imageMogr2/auto-orient/strip)

###æˆ‘

- è¿™ä¸ªé¡µé¢ä½œè€…å¾ˆç—›è‹¦ï¼Œå› ä¸ºæ˜¯é‡‡ç”¨å…¶ä»–é¡¹ç›®åµŒå¥—è¿›æ¥çš„ï¼Œå…¶å®å…³äºç½‘ç»œçš„çŸ¥è¯†å€’æ˜¯æ²¡æœ‰ï¼Œå¾ˆå¤šä»£ç å†™çš„UIï¼Œæ–°æ‰‹çœ‹çš„å°±ä¼šå¤´ç—›ï¼Œæœ¬äººä¹Ÿæ˜¯ï¼Œéƒ½æ„Ÿè§‰è¦åäº†,ä¸ªäººä¸­å¿ƒé‡‡ç”¨`TableView+è‡ªå®šä¹‰ä¸‰ä¸ªè§†å›¾`

```
    override func viewDidLoad() {
        super.viewDidLoad()
        setupTableView()
    }
    /// åˆ›å»º tableView
    private func setupTableView() {
        let tableView = UITableView()
        tableView.frame = view.bounds
        view.addSubview(tableView)
        tableView.separatorStyle = .None
        tableView.delegate = self
        tableView.dataSource = self
        tableView.tableHeaderView = headerView
    }

```

- æˆ‘çš„è®¢å•ï¼Œä¼˜æƒ åˆ¸ï¼Œæ¶ˆæ¯ï¼Œé‚£ä¸‰ä¸ªæ˜¯è‡ªå®šä¹‰è§†å›¾

```
import UIKit
import Kingfisher

enum MineHeadViewButtonType: Int {
    case Order = 0
    case Coupon = 1
    case Message = 2
}

class QJLMeChoiceView: UIView {
    
    var mineHeadViewClick:((type: MineHeadViewButtonType) -> ())?
    private let orderView = MineOrderView()
    private let couponView = MineCouponView()
    private let messageView = MineMessageView()
    private var couponNumber: UIButton?
    private let line1 = UIView()
    private let line2 = UIView()

    override init(frame: CGRect) {
        super.init(frame: frame)
        buildUI()
 
    }
    
    required init?(coder aDecoder: NSCoder) {
        fatalError("init(coder:) has not been implemented")
    }
    
    override func layoutSubviews() {
        super.layoutSubviews()
        let subViewW = SCREENW / 3.0
        orderView.frame = CGRectMake(0, 0, subViewW, height+20)
        couponView.frame = CGRectMake(subViewW, 0, subViewW, height+20)
        messageView.frame = CGRectMake(subViewW * 2, 0, subViewW, height+20)
        couponNumber?.frame = CGRectMake(subViewW * 1.56, 12, 15, 15)
        line1.frame = CGRectMake(subViewW - 0.5, height * 0.2, 1, height+10)
        line2.frame = CGRectMake(subViewW * 2 - 0.5, height * 0.2, 1, height+10)
    }
    
    func click(tap: UIGestureRecognizer) {
        if mineHeadViewClick != nil {
            
            switch tap.view!.tag {
                
            case MineHeadViewButtonType.Order.rawValue:
                mineHeadViewClick!(type: MineHeadViewButtonType.Order)
                break
                
            case MineHeadViewButtonType.Coupon.rawValue:
                mineHeadViewClick!(type: MineHeadViewButtonType.Coupon)
                break
                
            case MineHeadViewButtonType.Message.rawValue:
                mineHeadViewClick!(type: MineHeadViewButtonType.Message)
                break
                
            default: break
            }
        }
    }
     private func buildUI() {
        
        orderView.tag = 0
        addSubview(orderView)
        
        couponView.tag = 1
        addSubview(couponView)
        
        messageView.tag = 2
        addSubview(messageView)
        
        for index in 0...2 {
            let tap = UITapGestureRecognizer(target: self, action: "click:")
            let subView = viewWithTag(index)
            subView?.addGestureRecognizer(tap)
        }
        
        line1.backgroundColor = UIColor.grayColor()
        line1.alpha = 0.3
        addSubview(line1)
        
        line2.backgroundColor = UIColor.grayColor()
        line2.alpha = 0.3
        addSubview(line2)
        
        couponNumber = UIButton(type: .Custom)
        couponNumber?.setBackgroundImage(UIImage(named: "redCycle"), forState: UIControlState.Normal)
        couponNumber?.setTitleColor(UIColor.redColor(), forState: .Normal)
        couponNumber?.userInteractionEnabled = false
        couponNumber?.titleLabel?.font = UIFont.systemFontOfSize(8)
        couponNumber?.hidden = true
        addSubview(couponNumber!)
        
    }
    
    func setCouponNumer(number: Int) {
        if number > 0 && number <= 9 {
            couponNumber?.hidden = false
            couponNumber?.setTitle("\(number)", forState: .Normal)
        } else if number > 9 && number < 100 {
            couponNumber?.setTitle("\(number)", forState: .Normal)
            couponNumber?.hidden = false
        } else {
            couponNumber?.hidden = true
        }
    }

    class MineOrderView: UIView {
        
        var btn: MineUpImageDownText!
        
        override init(frame: CGRect) {
            super.init(frame: frame)
            btn = MineUpImageDownText(frame: CGRectZero, title: "æˆ‘çš„è®¢å•", imageName: "v2_my_order_icon")
            addSubview(btn)
        }
        
        required init?(coder aDecoder: NSCoder) {
            fatalError("init(coder:) has not been implemented")
        }
        
        override func layoutSubviews() {
            super.layoutSubviews()
            btn.frame = CGRectMake(10, 10, width - 20, height - 20)
        }
    }
    
    class MineCouponView: UIView {
        
        var btn: UpImageDownTextButton!
        
        override init(frame: CGRect) {
            super.init(frame: frame)
            btn = MineUpImageDownText(frame: CGRectZero, title: "ä¼˜æƒ åŠµ", imageName: "v2_my_coupon_icon")
            addSubview(btn)
        }
        
        required init?(coder aDecoder: NSCoder) {
            fatalError("init(coder:) has not been implemented")
        }
        
        override func layoutSubviews() {
            super.layoutSubviews()
            btn.frame = CGRectMake(10, 10, width - 20, height - 20)
        }
        
    }
    
    class MineMessageView: UIView {
        var btn: UpImageDownTextButton!
        
        override init(frame: CGRect) {
            super.init(frame: frame)
            btn = MineUpImageDownText(frame: CGRectZero, title: "æˆ‘çš„æ¶ˆæ¯", imageName: "v2_my_message_icon")
            addSubview(btn)
        }
        
        required init?(coder aDecoder: NSCoder) {
            fatalError("init(coder:) has not been implemented")
        }
        
        override func layoutSubviews() {
            super.layoutSubviews()
            btn.frame = CGRectMake(10, 10, width - 20, height - 20)
        }
    }
    
    class MineUpImageDownText: UpImageDownTextButton {
        
        init(frame: CGRect, title: String, imageName: String) {
            super.init(frame: frame)
            setTitle(title, forState: .Normal)
            setTitleColor(QJLColor(80, g: 80, b: 80,a: 1), forState: .Normal)
            setImage(UIImage(named: imageName), forState: .Normal)
            userInteractionEnabled = false
            titleLabel?.font = UIFont.systemFontOfSize(13)
        }
        
        required init?(coder aDecoder: NSCoder) {
            fatalError("init(coder:) has not been implemented")
        }

}
}
```

![æˆ‘.gif](http://upload-images.jianshu.io/upload_images/1754828-4cb2e34e200d31de.gif?imageMogr2/auto-orient/strip)

###è¶…å¸‚
 - è¿™æ˜¯é‡‡ç”¨å°ç†ŠSwifté¡¹ç›®é‡Œé¢å‚ç…§å†™çš„ï¼Œç›®çš„å°±æ˜¯ä¸ºäº†æ€ä¹ˆæ ·ç”¨ï¼ŒåµŒå¥—åˆ°è‡ªå·±çš„é¡¹ç›®ä¸­ï¼Œæœ¬äººèŠ±äº†å¾ˆä¹…çš„æ—¶é—´æ¥å®ç°ï¼Œä¸ªäººä¸­å¿ƒçš„é¡µé¢å¾ˆå¤šï¼Œè®¾è®¡çš„ä»£ç æˆ‘è¿™é‡Œä¸€æ—¶ä¹Ÿè¯´ä¸å®Œï¼Œåªèƒ½è°ˆè°ˆ

```
lass SupermarketViewController: SelectedAdressViewController {
    
    private var supermarketData: Supermarket?
    private var categoryTableView: LFBTableView!
    private var productsVC: ProductsViewController!
    
    private var categoryTableViewIsLoadFinish = false
    private var productTableViewIsLoadFinish  = false
    
    // MARK : Life cycle
    override func viewDidLoad() {
        super.viewDidLoad()
        
        addNotification()
        
        showProgressHUD()
        
        bulidCategoryTableView()
        
        bulidProductsViewController()
        
        loadSupermarketData()
    }
    
    override func viewWillAppear(animated: Bool) {
        super.viewWillAppear(animated)
        
        if productsVC.productsTableView != nil {
            productsVC.productsTableView?.reloadData()
        }
        
        NSNotificationCenter.defaultCenter().postNotificationName("LFBSearchViewControllerDeinit", object: nil)
        navigationController?.navigationBar.barTintColor =  QJLlobalRedColor()

    }
    
    deinit {
        NSNotificationCenter.defaultCenter().removeObserver(self)
    }
    
    private func addNotification() {
        NSNotificationCenter.defaultCenter().addObserver(self, selector: "shopCarBuyProductNumberDidChange", name: LFBShopCarBuyProductNumberDidChangeNotification, object: nil)
    }
    
    func shopCarBuyProductNumberDidChange() {
        if productsVC.productsTableView != nil {
            productsVC.productsTableView!.reloadData()
        }
    }
    
    // MARK:- Creat UI
    private func bulidCategoryTableView() {
        categoryTableView = LFBTableView(frame: CGRectMake(0, 0, ScreenWidth * 0.25, ScreenHeight), style: .Plain)
        categoryTableView.backgroundColor = QJLColor(239, g: 239, b: 239,a: 1)
        categoryTableView.delegate = self
        categoryTableView.dataSource = self
        categoryTableView.showsHorizontalScrollIndicator = false
        categoryTableView.showsVerticalScrollIndicator = false
        categoryTableView.contentInset = UIEdgeInsets(top: 0, left: 0, bottom: 64, right: 0)
        categoryTableView.hidden = true;
        view.addSubview(categoryTableView)
    }
    
    private func bulidProductsViewController() {
        productsVC = ProductsViewController()
        productsVC.delegate = self
        productsVC.view.hidden = true
        addChildViewController(productsVC)
        view.addSubview(productsVC.view)
        
        weak var tmpSelf = self
        productsVC.refreshUpPull = {
            let time = dispatch_time(DISPATCH_TIME_NOW,Int64(1.2 * Double(NSEC_PER_SEC)))
            dispatch_after(time, dispatch_get_main_queue(), { () -> Void in
                Supermarket.loadSupermarketData { (data, error) -> Void in
                    if error == nil {
                        tmpSelf!.supermarketData = data
                        tmpSelf!.productsVC.supermarketData = data
                        tmpSelf?.productsVC.productsTableView?.mj_header.endRefreshing()
                        tmpSelf!.categoryTableView.reloadData()
                        tmpSelf!.categoryTableView.selectRowAtIndexPath(NSIndexPath(forRow: 0, inSection: 0), animated: true, scrollPosition: .Top)
                    }
                }
            })
        }
    }
    
    private func loadSupermarketData() {
        let time = dispatch_time(DISPATCH_TIME_NOW, Int64(1 * Double(NSEC_PER_SEC)))
        dispatch_after(time, dispatch_get_main_queue()) { () -> Void in
            weak var tmpSelf = self
            Supermarket.loadSupermarketData { (data, error) -> Void in
                if error == nil {
                    tmpSelf!.supermarketData = data
                    tmpSelf!.categoryTableView.reloadData()
                    tmpSelf!.categoryTableView.selectRowAtIndexPath(NSIndexPath(forRow: 0, inSection: 0), animated: true, scrollPosition: .Bottom)
                    tmpSelf!.productsVC.supermarketData = data
                    tmpSelf!.categoryTableViewIsLoadFinish = true
                    tmpSelf!.productTableViewIsLoadFinish = true
                    if tmpSelf!.categoryTableViewIsLoadFinish && tmpSelf!.productTableViewIsLoadFinish {
                        tmpSelf!.categoryTableView.hidden = false
                        tmpSelf!.productsVC.productsTableView!.hidden = false
                        tmpSelf!.productsVC.view.hidden = false
                        tmpSelf!.categoryTableView.hidden = false
                        SVProgressHUD.dismiss()
                        tmpSelf!.view.backgroundColor = QJLColor(239, g: 239, b: 239,a: 1)

                    }
                }
            }
        }
    }
    
    // MARK: - Private Method
    private func showProgressHUD() {
        SVProgressHUD.setBackgroundColor(QJLColor(230, g: 230, b: 230,a: 1))
        view.backgroundColor = UIColor.whiteColor()
        if !SVProgressHUD.isVisible() {
            SVProgressHUD.showWithStatus("æ­£åœ¨åŠ è½½ä¸­")
        }
        
    }
}

// MARK: - UITableViewDelegate, UITableViewDataSource
extension SupermarketViewController: UITableViewDelegate, UITableViewDataSource {
    
    func tableView(tableView: UITableView, numberOfRowsInSection section: Int) -> Int {
        return supermarketData?.data?.categories?.count ?? 0
    }
    
    func tableView(tableView: UITableView, cellForRowAtIndexPath indexPath: NSIndexPath) -> UITableViewCell {
        let cell = CategoryCell.cellWithTableView(tableView)
        cell.categorie = supermarketData!.data!.categories![indexPath.row]
        
        return cell
    }
    
    func tableView(tableView: UITableView, heightForRowAtIndexPath indexPath: NSIndexPath) -> CGFloat {
        
        return 45
    }
    
    func tableView(tableView: UITableView, didSelectRowAtIndexPath indexPath: NSIndexPath) {
        if productsVC != nil {
            productsVC.categortsSelectedIndexPath = indexPath
        }
    }
    
}

// MARK: - SupermarketViewController
extension SupermarketViewController: ProductsViewControllerDelegate {
    
    func didEndDisplayingHeaderView(section: Int) {
        categoryTableView.selectRowAtIndexPath(NSIndexPath(forRow: section + 1, inSection: 0), animated: true, scrollPosition: UITableViewScrollPosition.Middle)
    }
    
    func willDisplayHeaderView(section: Int) {
        categoryTableView.selectRowAtIndexPath(NSIndexPath(forRow: section, inSection: 0), animated: true, scrollPosition: UITableViewScrollPosition.Middle)
    }


}

```

![è¶…å¸‚.gif](http://upload-images.jianshu.io/upload_images/1754828-a08fb867ce91f6a8.gif?imageMogr2/auto-orient/strip)

###è®¢å•å’Œæ¶ˆæ¯

- è¿™ä¸ªé¡µé¢æ•°æ®éƒ½æ˜¯æ­»çš„ï¼Œéƒ½æ˜¯åŠ è½½æœ¬åœ°çš„å†…å®¹æ¥å®ç°çš„ï¼Œ


![Snip20160812_1.png](http://upload-images.jianshu.io/upload_images/1754828-fd273a78dfb0a3d5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)



![è®¢å•å’Œæ¶ˆæ¯.gif](http://upload-images.jianshu.io/upload_images/1754828-7c8a17a8bac8ce50.gif?imageMogr2/auto-orient/strip)

##ç»“æŸè¯­
æœ¬æ¬¡çš„å•ç³–ä¹‹è¯´ä¸»è¦æ˜¯Swiftä½œå“çš„å¼€å¼€ç«¯ï¼Œåšçš„è¿˜ä¸ç®—æ˜¯æ¯”è¾ƒæ­£è§„ï¼Œç›®çš„å°±æ˜¯ä¸ºäº†è®©å¤§å®¶å¤šåŠ¨æ‰‹å»å‘è‡ªå·±ï¼Œè¿™æ ·æ‰ä¼šæˆé•¿ï¼Œå…¶å®è‡ªå·±å¯ä»¥ç…§ç€é¡¹ç›®å†™ï¼Œä»£ç å¯ä»¥æ…¢æ…¢ç†è§£ã€‚

##ä¸‹è½½åœ°å€
http://git.oschina.net/www.skyheng.com/DanTang
